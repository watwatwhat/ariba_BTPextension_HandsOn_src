# SAP Ariba x SAP BTP による Side-by-Side拡張 ハンズオン

## はじめに
このドキュメントでは、SAP AribaとSAP Business Technology Platform (BTP) を用いたSide-by-Side拡張のハンズオンについて説明します。このハンズオンでは、SAP Aribaの機能を拡張し、SAP BTP上で動作するカスタムアプリケーションの開発を行います。

## ハンズオンの事前準備
1. SAP Aribaアカウントの設定
2. SAP BTPアカウントの設定
3. 必要なツールのインストール
4. 開発環境のセットアップ

## ハンズオンの手順
ハンズオンを始める前に、以下の事前準備を確認し、必要なツールやアカウントが設定されていることを確認してください。

### 全体の流れ
ハンズオンは以下のステップで進行します。
1. 環境設定と確認
2. アプリケーションの確認
3. プレビューとデプロイ
4. 結果の確認と評価

### 1. 環境設定と確認
プロジェクトのルートディレクトリに`.cdsrc.json`を追加します。
中身には、以下の通りに入力して保存してください。これはAriba環境に関する設定データであり、プロジェクトに環境変数として読み込まれます。

```
{
    "realm": "<Aribaのレルム名>",
    "OAuth_client_id": "<取得したOauthクライアントID>",
    "OAuth_client_secret": "<取得したOauthクライアントシークレット>",
    "Base64Encoded_OAuth_client_id_and_secret": "<<取得したOauthクライアントID>:<取得したOauthクライアントパスワード>をBase64エンコーディングしたもの>",
    "ApplicationKey": "<取得したAPIキー>"
}
```

### 2. アプリケーションの確認

**ディレクトリ構成**

ハンズオンで使用する大まかなディレクトリの構成は以下の通りです。

| ディレクトリ | | 内容 |
| ---------------------- | ---- | ------------------------ |
| `./app`               | | UIフロントエンドのソースコード(フロントエンド本体) |
| `./db`                | | アプリ内で利用されるドメインモデルとデータ |
|  | `/data-model.cds` | ドメインモデル |
| `./srv`               | | アプリ内で利用されるサービスモデルとカスタムハンドラ(バックエンド本体) |
|  | `/server.js` | CORS設定をコントロールするミドルウェアを実装 |
|  | `/reporting-service.cds` | サービスモデル |
|  | `/reporting-service.js` | カスタムハンドラ |
|  | `/external/aribaOpenAPI.js` | AribaのAPIを呼び出すカスタムモジュール |
|  | `/lib/designTimeTools.js` | コーディング時に利用するカスタムモジュール |
|  | `/lib/queryOptionParser.js` | フロントエンドからのODataクエリをパースするカスタムモジュール |
|  | `/lib/responseProcessor.js` | フロントエンドへのODataレスポンスを$selectや$orderbyにより調整するカスタムモジュール |
| `./xs-security.json`       | | アプリを利用するために必要な権限ロールの設定 |
| `./mta.yaml`           | | Multi Target Application (mta) : BTP上のマイクロサービスを横断・統合したデプロイ設定 |
| `./package.json`       | | プロジェクトのメタデータと設定 |
| `./README.md`          | | 本スタートガイド |

### 3. プレビューとデプロイ

`cds watch` コマンドを使用すると、ローカル環境でのアプリケーションのプレビューが可能です。このコマンドは、ファイルの変更をリアルタイムで監視し、変更があるたびにアプリケーションを自動的に再起動します。これにより、開発中の迅速なフィードバックと効率的なテストが実現されます。以下を実行してください。

```bash
cds watch
```

`mbt build` コマンドにより、アプリケーションのビルドが行えます。このコマンドは、プロジェクトの依存関係を解決し、デプロイ用のアーカイブファイルを生成します。ビルドプロセスは、プロジェクトの全体的な構成を考慮して行われ、安定したデプロイメントを支援します。

```bash
mbt build
```

ビルド後、生成されたアーカイブファイルを使用して、`cf deploy` コマンドによりアプリケーションをSAP Cloud Platformにデプロイできます。このコマンドは、アプリケーションのデプロイメントを簡単かつ確実に行うための方法を提供します。

```bash
cf deploy aribaOpenAPI_proxy_1.0.0.mtar
```

### 4. 結果の確認と評価
SAP BTP Cockpit より、アプリケーションの確認が可能です。

## 終わりに
このハンズオンを通じて、SAP AribaとSAP BTPを活用した拡張開発の基本を理解し、実際のプロジェクトに応用できる知識と経験を得ることができます。

## さらなる深みへ！ 参考文献
| サイト名        |   URL   |
| -------------- | ------- |
| CAP 公式ドキュメント         | https://cap.cloud.sap/docs/get-started/ |
